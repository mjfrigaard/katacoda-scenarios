---
title: "Wrangling Data in R"
output: 
  github_document: 
    fig_height: 6
    fig_width: 8
    toc: yes
---

```{r setup, include=FALSE}
library(hrbrthemes)
library(extrafont)
library(knitr)
library(rmdformats)
library(tidyverse)
library(magrittr)
library(skimr)
library(rlang)
library(gt)
library(visdat)
library(inspectdf)
library(foreign)
library(naniar)
# images folder
if (!file.exists("figs")) {
  dir.create("figs")
}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = FALSE,
  cache = FALSE,
  prompt = FALSE,
  tidy = FALSE,
  fig.width = 10,
  fig.height = 7.5,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.path = "figs/"
)
knitr::opts_knit$set(
  width = 78
)
base::options(
  tibble.print_max = 25,
  tibble.width = 78,
  scipen = 100000000
)
ggplot2::theme_set(hrbrthemes::theme_ipsum_tw(
  base_size = 10,
  strip_text_size = 11,
  axis_title_size = 13,
  plot_title_size = 17,
  subtitle_size = 13,
  base_family = "Ubuntu",
  strip_text_family = "TitilliumWeb-Regular",
  axis_title_family = "TitilliumWeb-Regular",
  subtitle_family = "TitilliumWeb-Regular",
  plot_title_family = "JosefinSans-Regular"
))
```

## Intro

```markdown
This scenario will introduce how to use R to change columns from one type (or class) to another. In the wild, we rarely collect data in a format that they can be immediately analyzed or visualized in, so data wrangling is a common task.

## Variable types

Recall that variables can be characters (or strings), logicals (or boolean), and numbers (integer and double). In this first exercise, we'll be converting variables from one form to another using [`dplyr`](https://dplyr.tidyverse.org/), a package from the [`tidyverse`](https://www.tidyverse.org/).

To learn more about variable types, check out the transformation chapter in [R for Data Science](https://r4ds.had.co.nz/transform.html).
```


## step 1

> The `step1` file starts the scenario off an intro to R packages (the `library()` function), and how to create a data set in R to play with. This is important because having an ability to create data in R allows us to create a [minimal reproducible example](https://stackoverflow.com/help/minimal-reproducible-example), which gives us access to [The R questions on StackOverflow.](https://stackoverflow.com/questions/tagged/r).

> The markdown for the `step1.md` file is below.

Launch the R REPL with `R`

### Loading packages 

The  `tidyverse` started as the brainchild of RStudio Chief Scientist [Hadley Wickham](http://hadley.nz/). The `tidyverse` package actually loads multiple packages, all of which are centered around the common thread of [tidy data](https://vita.had.co.nz/papers/tidy-data.pdf) (more on this later). These packages were designed to work well together.

Install the `tidyverse` package (this requires an internet connection outside of Katacoda).

```{r step1-1, eval=FALSE}
install.packages("tidyverse")
```

 Load the package with the `library()` function.

```{r step1-2, eval=TRUE}
library(tidyverse)
```

R is an object-oriented and functional programming language. This just means it's made up of objects and functions. When we load data into R, we're creating a data object. In order to do things to this data object (manipulate, analyze, visualize, model, etc.), we'll need to use functions.

### Using functions

If you want to use a function from a package, the syntax for doing this is `package::function()`. For example, below we'll use the `tidyverse_logo()` function from the `tidyverse` package to view the awesome logo. 

```{r step1-2, eval=TRUE}
tidyverse::tidyverse_logo()
```

### Creating data

Next we're going to create a dataset with the `tibble::tribble()` function. Access the help file (enter `??tibble::tribble` in the R console) or read the documentation on the [tibble website](https://tibble.tidyverse.org/) to see how this function works, 

```{r step1-3, eval=TRUE}
# create data
BpData <- tibble::tribble(
  # variable names
  ~name, ~dob, ~wt_kg, ~ht_m, ~bp_d, ~bp_s,
  # data
  "john", "1985-10-13", 100L, "2.1", 80L, 130L,
  "peter", "1979-08-04", 82L, "1.9", 65L, 126L,
  "steve", "1981-04-23", 95L, "1.7", 70L, 119L,
  "sally", "1983-03-28", 72L, "1.5", 75L, 129L,
  "beth", "1986-06-07", 76L, "1.6", 78L, 126L,
  "kate", "1982-08-19", 69L, "1.5", 74L, 121L
)
```

To view the contents of `BpData`, we can enter the name into the console and a preview of the data will print to the Terminal.

```{r step1-3, eval=TRUE}
# print data
BpData
```


## Step 2

Functions are the verbs in the R language, and the data we've created is like an object (or noun). In English grammar, verbs do things to objects. In R, the functions allow us to  our data.

We'll start by doing a very common task in data wrangling: changing the format of a variable.

### Change the format of a variable

We are going to use the `dplyr::mutate()` function to change the format of the `ht_m` variable from character (`<chr>`) to numeric (`<dbl>`).

This is how `dplyr::mutate()` works:

```{r step2-1, eval=FALSE}
# a data set
dplyr::mutate(.data = DataFrame, 
              # changed variable
              `new variable name` = 
                  # function used to change variable
                   some_function(
                      # current variable name
                      `old variable name`))
```

As you can see from the code and comments above, first we enter the data set (`DataFrame`), then the name of the new variable we want to create (`new variable name`), the equals sign `=`, then the function we want to apply `some_function()` and the original variable we want to apply it to `old variable name`.

So if we run the code below, we should find the `ht_m` variable changes from character (`<chr>`) to numeric (or double `<dbl>`).

```{r step2-2}
# BpData data set
dplyr::mutate(.data = BpData, 
              # # changed variable
              ht_m = 
                  # function used to change variable
                  base::as.numeric(
                      # original variable name
                      ht_m),)
```

Now we can see the `ht_m` variable is a `<dbl>`. 

### Assignment 





```{r step2}
# load data
EconDataWide <- ggplot2::economics
EconDataWide %>% glimpse(78)

# change structure
tidyr::pivot_longer()
```

```{r step3}
# load data
EconDataLong <- ggplot2::economics_long
EconDataLong %>% glimpse(78)

# change structure
tidyr::pivot_wider()
```

```{r step5}
# load data
EconDataLong <- ggplot2::economics_long
EconDataLong %>% glimpse(78)

# change structure
tidyr::pivot_wider()
```
