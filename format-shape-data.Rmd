---
title: "Format and reshape your data in R with the tidyverse"
output: 
  html_document: 
    toc: yes
    toc_float: yes
    highlight: tango
    theme: cosmo
    keep_md: yes
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(rmdformats)
# figs folder
if (!file.exists("figs")) {
  dir.create("figs")
}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  cache = FALSE,
  prompt = FALSE,
  tidy = FALSE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.path = "figs/"
)
knitr::opts_knit$set(
  width = 78
)
base::options(
  tibble.print_max = 10,
  tibble.width = 78,
  scipen = 100000000
)
```

## Access the scenario

You can run through this scenario on Katacoda [here](https://katacoda.com/orm-mfrigaard/scenarios/format-shape-data).

## Setup

This scenario is built using the following commands in the Terminal pane in RStudio.

``` {.bash}
# create a new scenario
? Friendly url:  format-shape-data
? Scenario Title:  Format and shape your data in R with the tidyverse
? Scenario Description:  Quickly wrangle your data with the tidyr and dplyr packages from the tidyverse
? Difficulty Level:  Intermediate
? Estimated time: (Please specify in minutes or hours e.g. 2 hours) 40
? Number of Steps (Not including intro & finish):  12
? Image:  rlang:3.4
? Layout:  2x Terminal Split
```

The following folder was created from these commands.

```{r format-shape-data, echo=FALSE}
fs::dir_tree("format-shape-data")
```

We can see all `steps`, the `intro`, and `finish` markdown files. There is also an `index.json` file for managing all the steps in the Katacoda environment.

## Markdown syntax (Katacoda)

Katacoda comes with it's own flavor of Markdown, which you can learn more about [here.](https://katacoda.com/scenario-examples/scenarios/markdown-extensions). The main thing to know is that there are `execute` and `copy` extensions, which you can use in the markdown to indicate whether Katacoda should copy or run the code inside the R REPL.

## Learner personas

The learner personas for this scenario are:

1.  **Horatio** is an executive at a tech company who wants to learn more about data manipulation with R and Python

2.  **Judy** is a product manager at a start-up and needs to restructure data before loading it into their database.

3.  **Andrew** is a graduate student in college and needs to analyze his thesis/dissertation project.

------------------------------------------------------------------------

## Intro

-   [x] included in intro.md?

#### Getting your data into the correct shape

We rarely collect data in a way that can be immediately analyzed or visualized. "Wrangling," "munging," or "cleaning" are the steps to prepare data for a table, graph, algorithm, or model. These terms might sound like they're referring to tedious, menial work, but data wrangling is such a common task that most data scientists [consider it up to 80% of their job](https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html).

#### Goals & Lessons

This scenario will introduce the following topics in R:

1.  how to get data into R (manually, importing rectangular files, from packages)
2.  how to use R to reshape (or *reformat* and *reshape*) your data (pivot functions)\
3.  how to create new variables based on existing columns
4.  how to create new variables based on conditions (i.e. the values in) existing columns
5.  how to check your work with pivoting

#### The `tidyverse`

In this scenario, we'll be using the [`tidyverse packages`](https://www.tidyverse.org/), "an opinionated collection of R packages designed for data science"

## step 1 (install and load packages)

-   [x] included in step1.md?

### Getting started in R

Launch an R console by clicking here -\> `R`{{execute}}

You are looking at the R [REPL](https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop) (read-eval-print-loop) Katacoda has designed to run R in our browser.

#### The R language (in brief)

R is an object-oriented, functional programming scripting language. R is free and open-source software (FOSS) with a massive global community of users and developers who have helped create and maintain tools for data manipulation, graphics, statistics, and machine learning.

Generally speaking, the R language has *functions*, *commands*, and *operators*.

*Functions* take `input`s and return `output`s:

``` {.r}
function('input') {

    perform command(s) on 'input'
    
    return output
}
output
```

*Commands* are verbs we use to tell the R to do something. Unlike *functions*, *commands* don't always return an `output`.

For example, `install.packages()` downloads and installs R packages into a local folder on our computer, and the `library()` command loads the packages.

``` {.r}
install.packages("tidyverse")
library(tidyverse)
```

*Operators* are symbols (or collections of symbols) for performing arithmetic (`+`, `-`, `*`, `/`), Boolean (logical) operations (`TRUE` or `FALSE`), comparisons (`<`, `>`, `=<`, `=>`), and assignment (`<-` and `=`).

#### R packages

R `packages` are collections of commands for a particular purpose or task. R comes 'out of the box' with a handful of useful commands.

For this scenario, we'll be using the `tidyr` and `dplyr` packages for data manipulation. Both packages are part of the `tidyverse,` which is a suite of tools pioneered by RStudio's Chief Scientist [Hadley Wickham](http://hadley.nz/). All packages in the `tidyverse` work well together because they center around a common thread of [tidy data](https://vita.had.co.nz/papers/tidy-data.pdf).

#### Data in R

When we load data into R, these data get stored in a data object. To do things to any data object (manipulate, analyze, visualize, model, etc.), we'll need to use functions. We can write custom functions, or we can use one of the over 10,000 user-written packages available on [CRAN](https://cran.r-project.org/).

#### R in the Katacoda Terminal

Manipulating data in R requires sending commands to the Terminal. Sometimes these are commands we type ourselves, other times we will copy + paste code we can adapt from another source (like [Stack Overflow](https://stackoverflow.com/)). **THIS IS A NORMAL PART OF CODING.** Feel free to adapt and experiment with code you find (provided it's not someone else's private work).

Install the `tidyverse` package by clicking on the 'copy' icon below and pasting the code into the Terminal window, then hitting <kbd>enter</kbd> or <kbd>return</kbd>.

<kbd>Ctrl</kbd>+<kbd>V</kbd>

*or*

<kbd>Cmd</kbd>+<kbd>V</kbd>


```r
# click to copy code
install.packages("tidyverse")
```

Load the package with the `base::library()` function.

```r
# click to copy code
library(tidyverse)
```

#### R Code style

The code in this scenario follows the [`tidyverse` style guide](https://style.tidyverse.org/) as closely as possible.

> "*Each line of a comment should begin with the comment symbol and a single space: `#`*"

```{r comments}
# comments aren't run in the terminal
```

> "*In data analysis code, use comments to record important findings and analysis decisions. If you need comments to explain what your code is doing, consider rewriting your code to be clearer.*"

#### Using R functions

If we want to use a function from a package, the syntax for doing this is `package::function()`

For example, below, we'll use the `tidyverse_logo()` function from the `tidyverse` package to view an awesome logo.

```{r tidyverse_logo}
# click to execute code
tidyverse::tidyverse_logo()
```


The `tidyverse::tidyverse_logo()` function can run without any arguments (i.e. nothing inside the parentheses), but we can view the arguments by placing the cursor inside the parenthesis and hitting the <kbd>tab</kbd> key.

We can enter function arguments by position or name (see below).

![](https://raw.githubusercontent.com/mjfrigaard/katacoda-data-wrangle-viz-show/master/figs/00-name-arg.png)

![](https://raw.githubusercontent.com/mjfrigaard/katacoda-data-wrangle-viz-show/master/figs/00-name-arg.png)

## step 2 (data in packages)

### Data in packages

It's hard to learn any of R's capabilities without a dataset. There are multiple ways to get datasets into the R environment, but we'll cover that in another scenario. 

Today we'll be using a dataset from the [`fivethirtyeight` package](https://cran.r-project.org/web/packages/fivethirtyeight/vignettes/fivethirtyeight.html) in R. This package has over 100 datasets from articles on the website [FiveThirtyEight](https://fivethirtyeight.com/).  

The dataset we will be using today comes from the article ["A Statistical Analysis of the Work of Bob Ross."](https://fivethirtyeight.com/features/a-statistical-analysis-of-the-work-of-bob-ross/)

![](https://raw.githubusercontent.com/mjfrigaard/katacoda-data-wrangle-viz-show/master/figs/00-538-bob-ross.png)

Bob Ross was the host of [The Joy of Painting](https://en.wikipedia.org/wiki/The_Joy_of_Painting), a painting educational program from 1980 - 1994.

We'll load the `BobRoss` dataset into R using `fivethirtyeight::bob_ross`. 

First, we have to install and load the package into the R environment.

```{r fivethirtyeight, eval=FALSE, results='hide'}
# click to execute code
install.packages("fivethirtyeight")
library(fivethirtyeight)
```

Now we can assign the `bob_ross` data frame into the `BobRoss` object. 

```{r BobRoss}
# click to execute code
BobRoss <- fivethirtyeight::bob_ross
```

```{r print-BobRoss}
# click to execute code
# print data
BobRoss
```

We should pay attention to the information printed in `BobRoss`. As we can see, it's contained in a `tibble`. 

`tibble`s print the dimensions of the dataset (`# A tibble: 403 x 71`), numerical indices for rows (far left), and the type of variable in the dataset (`<chr>` variables have text information vs. `<dbl>` and `<int>` variables which contain numbers), and additional information about the data when it's too big to print on the screen (`… with 393 more rows, and 63 more variables:`)

## step 3 (Data frames and tibbles)

### Data frames and tibbles

One quick and easy way to get data into R is to create the data 'by hand' using the `tibble::tribble()` function. Read more about tibbles [here in R For Data Science](https://learning.oreilly.com/library/view/r-for-data/9781491910382/ch07.html#tibbles).

These data are stored as a [comma-separated values](https://en.wikipedia.org/wiki/Comma-separated_values) file on Github (see below).

```
title,  bushes,  clouds,
"A WALK IN THE WOODS", 1L, 0L,
"MT. MCKINLEY", 0L, 1L,
"EBONY SUNSET", 0L, 0L,
"WINTER MIST", 1L, 1L,
"QUIET STREAM", 0L, 0L,
"WINTER MOON", 0L, 0L,
"AUTUMN MOUNTAINS", 0L, 0L,
"PEACEFUL VALLEY", 1L, 0L,
"SEASCAPE", 0L, 1L,
"MOUNTAIN LAKE", 1L, 0L,
"WINTER GLOW", 0L, 0L,
"SNOWFALL", 0L, 1L,
"FINAL REFLECTIONS", 1L, 0L,
"MEADOW LAKE", 1L, 0L,
"WINTER SUN", 0L, 0L
```

A description of these variables is below:

+ `title`: Title of episode

+ `bushes`: Present (`1`) or not (`0`)  

+ `clouds`: Present (`1`) or not (`0`)

#### Rectangular data

Both data frames (called `data.frame`s in R) and `tibble`s are rectangular data objects. They have columns and rows for storing data, similar to a spreadsheet in Excel. The main difference between a `tibble` and a `data.frame` is how they are printed to the console. We are going to create a `tibble` and `data.frame` with the data above to demonstrate these differences.

#### Create a `tibble`

The `tibble::tribble()` function takes column names preceded by the tilde (i.e. `~column`), then get separated by commas (`~column1`, `~column2`, `~column3`). Then `tibble::tribble()` reads the data starting on the second line, similar to the way the actual data are stored above.

The `tibble` we create below is a small sample from the [`bob_ross`](https://fivethirtyeight-r.netlify.app/articles/fivethirtyeight.html) dataset. The code below creates `BobRossTibble` from the data above in the R environment.

```{r BobRossTibble}
# click to execute code
BobRossTibble <- tibble::tribble(
                   ~title, ~bushes, ~clouds,
    "A WALK IN THE WOODS",      1L,      0L,
           "MT. MCKINLEY",      0L,      1L,
           "EBONY SUNSET",      0L,      0L,
            "WINTER MIST",      1L,      1L,
           "QUIET STREAM",      0L,      0L,
            "WINTER MOON",      0L,      0L,
       "AUTUMN MOUNTAINS",      0L,      0L,
        "PEACEFUL VALLEY",      1L,      0L,
               "SEASCAPE",      0L,      1L,
          "MOUNTAIN LAKE",      1L,      0L,
            "WINTER GLOW",      0L,      0L,
               "SNOWFALL",      0L,      1L,
      "FINAL REFLECTIONS",      1L,      0L,
            "MEADOW LAKE",      1L,      0L,
             "WINTER SUN",      0L,      0L)
BobRossTibble
```

#### Create a `data.frame`

The `base::data.frame()` function creates columns transposed, with values displayed left to right). We can create `data.frame`s with a series of named vectors, or supply them directly to the function (both work).

Below we create three vectors (`title`, `bushes`, and `clouds`), then supply these to the `base::data.frame()` function and assign it to `BobRossDataFrame`. The names of the vectors end up being the column names.

```{r data.frame-as-vectors}
# click to execute code
title <- c("A WALK IN THE WOODS", "MT. MCKINLEY", "EBONY SUNSET", 
            "WINTER MIST", "QUIET STREAM", "WINTER MOON", "AUTUMN MOUNTAINS", 
            "PEACEFUL VALLEY", "SEASCAPE", "MOUNTAIN LAKE", "WINTER GLOW", 
            "SNOWFALL", "FINAL REFLECTIONS", "MEADOW LAKE", "WINTER SUN")
bushes <- c(1L, 0L, 0L, 1L, 0L, 0L, 0L, 1L, 0L, 1L, 0L, 0L, 1L, 1L, 0L)
clouds <- c(0L, 1L, 0L, 1L, 0L, 0L, 0L, 0L, 1L, 0L, 0L, 1L, 0L, 0L, 0L)
BobRossDataFrame <- data.frame(title, bushes, clouds)
BobRossDataFrame
```

This is the same `data.frame`, but with the vectors supplied as arguments *inside* the `data.frame()` function. 

```{r BobRossDataFrame-vectors-as-args}
# click to execute code
BobRossDataFrame <- data.frame(
  title = c("A WALK IN THE WOODS", "MT. MCKINLEY", "EBONY SUNSET", 
            "WINTER MIST", "QUIET STREAM", "WINTER MOON", "AUTUMN MOUNTAINS", 
            "PEACEFUL VALLEY", "SEASCAPE", "MOUNTAIN LAKE", "WINTER GLOW", 
            "SNOWFALL", "FINAL REFLECTIONS", "MEADOW LAKE", "WINTER SUN"),
  bushes = c(1L, 0L, 0L, 1L, 0L, 0L, 0L, 1L, 0L, 1L, 0L, 0L, 1L, 1L, 0L),
  clouds = c(0L, 1L, 0L, 1L, 0L, 0L, 0L, 0L, 1L, 0L, 0L, 1L, 0L, 0L, 0L))
BobRossDataFrame
```


## Appendix 1: Katacoda scenario tutorials

The tutorial for building the scenario is [here](https://katacoda.com/scenario-examples/scenarios/create-scenario-101).

I took notes on this tutorial and made them available in [this Google document](https://docs.google.com/document/d/e/2PACX-1vSf2w2onhH5t3IhuD4sYLoWqn46BLKMYFR7q3BHO8QTaRkVgXfhKvnl8T9uHrjmbVpTZVKCWrfxEl0R/pub).

## Appendix 2: Katacoda guidelines

There are multiple guidelines and resources for writing scenarios. O'Reilly has provided an *Authoring Guide* and *Formatting and Design Guide*.

The link for these files can be found here:

-   [Katacoda Scenario Formatting and Design Guide for Authors](https://docs.google.com/document/d/1l4lofG5kAu8JFzumZPCsJJE2muCYe6rHSHCQsMlijd8/edit)

-   [Katacoda Scenario Authoring Guide](https://docs.google.com/document/d/14rudtruZQhRxvD3zcR3g75j5nuOgKGz4CYk8hdhaV-w/edit)

## Appendix 3: Scenario Checklist

**Scenario Readiness Checklist:**

When you think your scenario is ready for publication, we recommend you run through the checklist below to ensure it is ready to go. [Reminder: We discuss these best practices in the Katacoda Formatting and Design Guide for Authors]:

Does the scenario start consistently and in a timely manner? More than 5 minutes to start would be cause to reconsider your build decisions.

-   [ ] Are your intro and final pages present and are their respective goals and lessons learned in agreement?

-   [ ] Have you tested your scenario lately?

-   [ ] Do you agree with the leveling (beginner, intermediate, advanced) you indicated when you started the build?

-   [ ] Was learning time you entered correct, or should it be adjusted?

-   [ ] Are your versions of tools and other dependencies up to date?

-   [ ] Have you tried every instruction?

-   [ ] Have you written each step in the most concise manner possible?

-   [ ] Have you run your text through a spelling/grammar checker?

-   [ ] Are your credits to others given present and correct?

-   [ ] Are your images legal and with credits?

-   [ ] Are your hyperlinks all working?

-   [ ] Do the goals and lessons learned items match the steps in the scenario?
